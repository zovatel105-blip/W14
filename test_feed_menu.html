<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Feed Menu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        button {
            background: #FF0050;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #cc0040;
        }
        .result {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { border-left: 4px solid #00ff00; }
        .error { border-left: 4px solid #ff0000; }
    </style>
</head>
<body>
    <h1>üß™ Test Feed Menu Functionality</h1>
    
    <div class="container">
        <h2>1. Login First</h2>
        <button onclick="testLogin()">Login as Test User</button>
        <div id="loginResult" class="result"></div>
    </div>
    
    <div class="container">
        <h2>2. Test Feed Menu Actions</h2>
        <button onclick="testNotInterested()">üö´ No me interesa</button>
        <button onclick="testHideUser()">üë§ Ocultar usuario</button>
        <button onclick="testToggleNotifications()">üîî Toggle Notifications</button>
        <button onclick="testReport()">üö© Reportar</button>
        <button onclick="testGetPreferences()">üìã Get Preferences</button>
        <div id="menuResult" class="result"></div>
    </div>

    <script>
        let token = '';
        const BACKEND_URL = 'http://localhost:8001';
        const TEST_POLL_ID = 'a91eff22-8548-4f8f-ad6e-702c1283b96c';
        const TEST_USER_ID = '2be7cfe8-6d22-4c04-a7ca-1f7731f08f10';

        async function testLogin() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'test_feed@example.com',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    token = data.access_token;
                    document.getElementById('loginResult').innerHTML = 
                        `<span class="success">‚úÖ Login successful! User: ${data.user.username}</span>`;
                } else {
                    document.getElementById('loginResult').innerHTML = 
                        `<span class="error">‚ùå Login failed: ${data.detail}</span>`;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<span class="error">‚ùå Login error: ${error.message}</span>`;
            }
        }

        async function testNotInterested() {
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/feed/not-interested?poll_id=${TEST_POLL_ID}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                document.getElementById('menuResult').innerHTML = response.ok 
                    ? `<span class="success">‚úÖ Not interested: ${data.message}</span>`
                    : `<span class="error">‚ùå Error: ${data.detail}</span>`;
            } catch (error) {
                document.getElementById('menuResult').innerHTML = 
                    `<span class="error">‚ùå Network error: ${error.message}</span>`;
            }
        }

        async function testHideUser() {
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/feed/hide-user?author_id=${TEST_USER_ID}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                document.getElementById('menuResult').innerHTML = response.ok 
                    ? `<span class="success">‚úÖ Hide user: ${data.message}</span>`
                    : `<span class="error">‚ùå Error: ${data.detail}</span>`;
            } catch (error) {
                document.getElementById('menuResult').innerHTML = 
                    `<span class="error">‚ùå Network error: ${error.message}</span>`;
            }
        }

        async function testToggleNotifications() {
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/feed/toggle-notifications?author_id=${TEST_USER_ID}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                document.getElementById('menuResult').innerHTML = response.ok 
                    ? `<span class="success">‚úÖ Notifications: ${data.message} (enabled: ${data.notifications_enabled})</span>`
                    : `<span class="error">‚ùå Error: ${data.detail}</span>`;
            } catch (error) {
                document.getElementById('menuResult').innerHTML = 
                    `<span class="error">‚ùå Network error: ${error.message}</span>`;
            }
        }

        async function testReport() {
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/feed/report`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        poll_id: TEST_POLL_ID,
                        category: 'spam',
                        comment: 'Test report from HTML page'
                    })
                });
                
                const data = await response.json();
                document.getElementById('menuResult').innerHTML = response.ok 
                    ? `<span class="success">‚úÖ Report: ${data.message}</span>`
                    : `<span class="error">‚ùå Error: ${data.detail}</span>`;
            } catch (error) {
                document.getElementById('menuResult').innerHTML = 
                    `<span class="error">‚ùå Network error: ${error.message}</span>`;
            }
        }

        async function testGetPreferences() {
            if (!token) {
                alert('Please login first');
                return;
            }
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/feed/user-preferences`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                document.getElementById('menuResult').innerHTML = response.ok 
                    ? `<span class="success">‚úÖ Preferences: ${JSON.stringify(data.data, null, 2)}</span>`
                    : `<span class="error">‚ùå Error: ${data.detail}</span>`;
            } catch (error) {
                document.getElementById('menuResult').innerHTML = 
                    `<span class="error">‚ùå Network error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>